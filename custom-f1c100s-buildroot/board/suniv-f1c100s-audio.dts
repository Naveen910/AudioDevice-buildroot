/dts-v1/;
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/clock/suniv-ccu-f1c100s.h>
#include <dt-bindings/reset/suniv-ccu-f1c100s.h>
#include <dt-bindings/dma/sun4i-a10.h>


/ {
	model = "F1C100s Custom Audio Board";
	compatible = "custom,audio-board", "allwinner,suniv-f1c100s";
	#address-cells = <1>;
	#size-cells = <1>;
	interrupt-parent = <&intc>;

	aliases {
		serial0 = &uart0;
		i2c0 = &i2c0;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};

	clocks {
		osc24M: clk-24M {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <24000000>;
			clock-output-names = "osc24M";
		};

		osc32k: clk-32k {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <32768>;
			clock-output-names = "osc32k";
		};
	};

	cpus {
		#address-cells = <1>;
		#size-cells = <0>;

		cpu@0 {
			compatible = "arm,arm926ej-s";
			device_type = "cpu";
			reg = <0x0>;
		};
	};

	vcc_pe: vcc-pe-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc-pe";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};

	vcc_pd: vcc-pd-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc-pd";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};

	vcc_pf: vcc-pf-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc-pf";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};

	vmmc_reg: vmmc-supply {
		compatible = "regulator-fixed";
		regulator-name = "vmmc";
		regulator-min-microvolt = <3300000>; /* or 1800000 if card uses 1.8V */
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};




	max98357a: max98357a {
		compatible = "maxim,max98357a";
		#sound-dai-cells = <0>;
	};

	
	sound {
    	compatible = "simple-audio-card";
    	simple-audio-card,name = "F1C100s-MAX98357A";
    	simple-audio-card,format = "i2s";
	
    	simple-audio-card,bitclock-master = <&i2s0>;
    	simple-audio-card,frame-master = <&i2s0>;
	
    	simple-audio-card,widgets =
    	    "Speaker", "External Speaker";
	
    	simple-audio-card,routing =
    	    "External Speaker", "Speaker";
	
    	simple-audio-card,cpu {
    	    sound-dai = <&i2s0>;
    	};
	
    	simple-audio-card,codec {
    	    sound-dai = <&max98357a>;
    	};
	};


	
	gpio_keys {
		compatible = "gpio-keys";
		pinctrl-names = "default";
		autorepeat;

		/* B1 - Play/Pause - PD2 */
		button_play {
			label = "PlayPause";
			linux,code = <1>;
			gpios = <&pio 3 2 GPIO_ACTIVE_LOW>; /* Bank 3 (PD) Pin 2 */
			wakeup-source;
		};

		/* B2 - Stop - PD3 */
		button_stop {
			label = "Stop";
			linux,code = <2>;
			gpios = <&pio 3 3 GPIO_ACTIVE_LOW>;
		};

		/* B3 - Previous - PD4 */
		button_prev {
			label = "Previous";
			linux,code = <3>;
			gpios = <&pio 3 4 GPIO_ACTIVE_LOW>;
		};

		/* B4 - Next - PD5 */
		button_next {
			label = "Next";
			linux,code = <4>;
			gpios = <&pio 3 5 GPIO_ACTIVE_LOW>;
		};

		/* B5 - Volume Down - PD6 */
		button_voldn {
			label = "Volume Down";
			linux,code = <5>;
			gpios = <&pio 3 6 GPIO_ACTIVE_LOW>;
		};

		/* B6 - Volume Up - PD7 */
		button_volup {
			label = "Volume Up";
			linux,code = <6>;
			gpios = <&pio 3 7 GPIO_ACTIVE_LOW>;
		};

		/* B7 - Menu - PD15 */
		button_menu {
			label = "Menu";
			linux,code = <7>;
			gpios = <&pio 3 15 GPIO_ACTIVE_LOW>;
		};

		/* B8 - Back - PD16 */
		button_back {
			label = "Back";
			linux,code = <8>;
			gpios = <&pio 3 16 GPIO_ACTIVE_LOW>;
		};

		/* B9 - Enter - PD17 */
		button_enter {
			label = "Enter";
			linux,code = <9>;
			gpios = <&pio 3 17 GPIO_ACTIVE_LOW>;
		};

		/* B10 - Mute - PD18 */
		button_mute {
			label = "Mute";
			linux,code = <10>;
			gpios = <&pio 3 18 GPIO_ACTIVE_LOW>;
		};

		/* B11 - Mode - PD19 */
		button_mode {
			label = "Mode";
			linux,code = <11>;
			gpios = <&pio 3 19 GPIO_ACTIVE_LOW>;
		};
	};

	soc {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		sram-controller@1c00000 {
			compatible = "allwinner,suniv-f1c100s-system-control",
				     "allwinner,sun4i-a10-system-control";
			reg = <0x01c00000 0x30>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			sram_d: sram@10000 {
				compatible = "mmio-sram";
				reg = <0x00010000 0x1000>;
				#address-cells = <1>;
				#size-cells = <1>;
				ranges = <0 0x00010000 0x1000>;

				otg_sram: sram-section@0 {
					compatible = "allwinner,suniv-f1c100s-sram-d",
						     "allwinner,sun4i-a10-sram-d";
					reg = <0x0000 0x1000>;
					status = "disabled";
				};
			};
		};


		mmc0: mmc@1c0f000 {
			compatible = "allwinner,suniv-f1c100s-mmc",
				     "allwinner,sun7i-a20-mmc";
			reg = <0x01c0f000 0x1000>;
			clocks = <&ccu CLK_BUS_MMC0>,
				 <&ccu CLK_MMC0>,
				 <&ccu CLK_MMC0_OUTPUT>,
				 <&ccu CLK_MMC0_SAMPLE>;
			clock-names = "ahb", "mmc", "output", "sample";
			resets = <&ccu RST_BUS_MMC0>;
			reset-names = "ahb";
			interrupts = <23>;
			pinctrl-names = "default";
			pinctrl-0 = <&mmc0_pins>;
			status = "okay";

			vmmc-supply = <&vmmc_reg>;
			vqmmc-supply = <&vmmc_reg>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		intc: interrupt-controller@1c20400 {
			compatible = "allwinner,suniv-f1c100s-ic";
			reg = <0x01c20400 0x400>;
			interrupt-controller;
			#interrupt-cells = <1>;
		};

		ccu: clock@1c20000 {
			compatible = "allwinner,suniv-f1c100s-ccu";
			reg = <0x01c20000 0x400>;
			clocks = <&osc24M>, <&osc32k>;
			clock-names = "hosc", "losc";
			#clock-cells = <1>;
			#reset-cells = <1>;
		};

		pio: pinctrl@1c20800 {
			compatible = "allwinner,suniv-f1c100s-pinctrl";
			reg = <0x01c20800 0x400>;
			interrupts = <38>, <39>, <40>;
			clocks = <&ccu CLK_BUS_PIO>, <&osc24M>, <&osc32k>;
			clock-names = "apb", "hosc", "losc";
			gpio-controller;
			interrupt-controller;
			#interrupt-cells = <3>;
			#gpio-cells = <3>;

			mmc0_pins: mmc0-pins {
				pins = "PF0", "PF1", "PF2", "PF3", "PF4", "PF5";
				function = "mmc0";
				drive-strength = <30>;
			};

			uart0_pe_pins: uart0-pe-pins {
				pins = "PE0", "PE1";
				function = "uart0";
			};

			i2c0_pe_pins: i2c0-pe-pins {
				pins = "PE11", "PE12";
				function = "i2c0";
				bias-pull-up;
			};

			i2s0_pd_pins: i2s0-pd-pins {
				pins = "PD8", "PD9", "PD11";
				function = "i2s";
			};

			
		};

		uart0: serial@1c25000 {
			compatible = "snps,dw-apb-uart";
			reg = <0x01c25000 0x400>;
			interrupts = <1>;
			reg-shift = <2>;
			reg-io-width = <4>;
			clocks = <&ccu CLK_BUS_UART0>;
			resets = <&ccu RST_BUS_UART0>;
			pinctrl-names = "default";
			pinctrl-0 = <&uart0_pe_pins>; 
			status = "okay";
		};



		i2c0: i2c@1c27000 {
			compatible = "allwinner,suniv-f1c100s-i2c", "allwinner,sun6i-a31-i2c";
			reg = <0x01c27000 0x400>;
			interrupts = <7>;
			clocks = <&ccu CLK_BUS_I2C0>;
			resets = <&ccu RST_BUS_I2C0>;
			status = "okay";
			pinctrl-names = "default";
			pinctrl-0 = <&i2c0_pe_pins>;

			si4703: fm-radio@10 {
				compatible = "silabs,si470x";
				reg = <0x10>;
				reset-gpios = <&pio 3 0 GPIO_ACTIVE_LOW>; /* PD0 */
				interrupt-parent = <&pio>;
				interrupts = <3 1 IRQ_TYPE_EDGE_FALLING>; /* Bank 3 (PD) Pin 1 */
			};
		};

		i2s0: i2s@1c22000 {
			compatible = "allwinner,sun6i-a31-i2s", "allwinner,suniv-f1c100s-i2s", "allwinner,sun4i-a10-i2s";
			#sound-dai-cells = <0>;
			reg = <0x01c22000 0x400>;
			interrupts = <35>;
			clocks = <&ccu CLK_BUS_I2S0>, <&ccu CLK_I2S>;
			clock-names = "apb", "mod";
			resets = <&ccu RST_BUS_I2S0>;
			dmas = <&dma SUN4I_DMA_NORMAL 0x0e>,
					 <&dma SUN4I_DMA_NORMAL 0x0e>;
			dma-names = "rx", "tx";
			status = "okay";
			pinctrl-names = "default";
			pinctrl-0 = <&i2s0_pd_pins>;
		};

		timer@1c20c00 {
			compatible = "allwinner,suniv-f1c100s-timer";
			reg = <0x01c20c00 0x90>;
			interrupts = <13>, <14>, <15>;
			clocks = <&osc24M>;
		};

		wdt: watchdog@1c20ca0 {
			compatible = "allwinner,suniv-f1c100s-wdt",
				     "allwinner,sun6i-a31-wdt";
			reg = <0x01c20ca0 0x20>;
			interrupts = <16>;
			clocks = <&osc32k>;
		};


		dma: dma-controller@1c02000 {
			compatible = "allwinner,suniv-f1c100s-dma";
			reg = <0x01c02000 0x1000>;
			interrupts = <18>;
			clocks = <&ccu CLK_BUS_DMA>;
			resets = <&ccu RST_BUS_DMA>;
			#dma-cells = <2>;
		};

		codec: codec@1c23c00 {
			#sound-dai-cells = <0>;
			compatible = "allwinner,suniv-f1c100s-codec";
			reg = <0x01c23c00 0x400>;
			interrupts = <21>;
			clocks = <&ccu CLK_BUS_CODEC>, <&ccu CLK_CODEC>;
			clock-names = "apb", "codec";
			dmas = <&dma SUN4I_DMA_NORMAL 12>,
			       <&dma SUN4I_DMA_NORMAL 12>;
			dma-names = "rx", "tx";
			resets = <&ccu RST_BUS_CODEC>;
			status = "okay";
		};

	};
};